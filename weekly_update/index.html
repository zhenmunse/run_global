<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>润学周报 - 永不失联</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/common.css">
  <style>
    .wrap{padding-top:72px}
    h1{font-size:20px;margin:0}
    header p{margin:0;color:var(--muted);font-size:13px}
    main{ display:grid; gap:24px; margin-bottom:28px; background:transparent; padding:0; border:0; box-shadow:none; }

    .issue-list{
      display:flex;
      flex-direction:column;
      gap:20px;
    }
    .issue{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      border-radius:10px;
      padding:20px;
      transition:transform 0.2s ease, background 0.2s ease;
    }
    .issue:hover{
      transform:translateY(-2px);
      background:rgba(255,255,255,0.03);
    }
    .issue-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .issue-title{
      font-size:18px;
      font-weight:600;
      margin:0;
    }
    .issue-date{
      color:var(--muted);
      font-size:13px;
    }
    .issue-summary{
      color:var(--muted);
      line-height:1.6;
      margin-bottom:16px;
    }
    .issue-link{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      border-radius:8px;
      background:linear-gradient(90deg,var(--accent),#7dd3fc);
      color:#04263b;
      text-decoration:none;
      font-weight:600;
      font-size:14px;
      transition:transform 0.2s ease;
    }
    .issue-link:hover{
      transform:translateY(-1px);
    }

    .control-panel{
      background:transparent;
      border:0;
      padding:24px 0 8px 0;
      margin-bottom:12px;
      display:grid;
      grid-template-columns:1fr 1fr auto;
      gap:24px;
      align-items:end;
    }
    .control-panel label{
      display:block;
      font-size:14px;
      font-weight:600;
      color:#e6eef8;
      margin-bottom:8px;
    }
    .issue-selector{
      display:flex;
      flex-direction:column;
    }
    .issue-select{
      padding:10px 14px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.1);
      background:rgba(255,255,255,0.02);
      color:#e6eef8;
      font-size:14px;
      font-weight:500;
      min-width:200px;
      transition:all 0.2s ease;
    }
    .issue-select:focus{
      outline:none;
      border-color:var(--accent);
      background:rgba(255,255,255,0.05);
    }
    .issue-select option{
      background:#1a2332;
      color:#e6eef8;
      padding:8px;
    }
    

  /* current-issue should not have an extra card border when wrapped by outer .card */
  .current-issue{ background:transparent; border:0; padding:0; margin-top:12px }

    .refresh-btn{
      padding:10px 16px;
      border:1px solid rgba(255,255,255,0.1);
      border-radius:8px;
      background:rgba(255,255,255,0.02);
      color:var(--muted);
      cursor:pointer;
      font-size:14px;
      font-weight:500;
      transition:all 0.2s ease;
      white-space:nowrap;
    }
    .refresh-btn:hover{
      background:rgba(255,255,255,0.05);
      border-color:var(--accent);
      color:#e6eef8;
    }
    
    .news-item{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      border-radius:10px;
      padding:20px;
      transition:all 0.2s ease;
    }
    .news-item:hover{
      transform:translateY(-2px);
      background:rgba(255,255,255,0.03);
      border-color:rgba(110,168,254,0.3);
    }
    .news-item-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .news-item-date{
      font-size:16px;
      font-weight:600;
      margin:0;
    }
    .news-item-actions{
      display:flex;
      gap:8px;
    }
    .news-item-btn{
      padding:6px 12px;
      border-radius:6px;
      text-decoration:none;
      font-size:12px;
      font-weight:600;
      transition:all 0.2s ease;
    }
    .btn-view{
      background:linear-gradient(90deg,var(--accent),#7dd3fc);
      color:#04263b;
    }
    .btn-raw{
      background:rgba(255,255,255,0.05);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.1);
    }
    .news-item-btn:hover{
      transform:translateY(-1px);
    }
    .news-item-preview{
      color:var(--muted);
      font-size:14px;
      line-height:1.6;
      margin:0;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:3;
      line-clamp:3;
      -webkit-box-orient:vertical;
    }

    .current-issue{
      background:rgba(255,255,255,0.01);
      border:1px solid rgba(255,255,255,0.04);
      border-radius:12px;
      overflow:hidden;
    }
    .current-issue-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:20px 24px;
      background:rgba(255,255,255,0.02);
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .current-issue-header h3{
      margin:0;
      font-size:18px;
      color:#e6eef8;
    }
    .issue-actions{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .view-btn{
      padding:6px 12px;
      border-radius:6px;
      text-decoration:none;
      font-size:12px;
      font-weight:600;
      transition:all 0.2s ease;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .view-btn.secondary{
      background:rgba(255,255,255,0.05);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.1);
    }
    .view-btn:hover{
      transform:translateY(-1px);
    }

    .issue-frame-container{
      position:relative;
      height:75vh;
      min-height:500px;
    }
    .issue-content{
      width:100%;
      height:100%;
      padding:20px;
      overflow:auto; /* allow scrolling */
      color:var(--muted);
      background:transparent;
    }
    .loading-indicator{
      position:absolute;
      top:0;
      left:0;
      right:0;
      bottom:0;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      background:rgba(15,23,36,0.9);
      z-index:10;
    }
    .loading-indicator.hidden{
      display:none;
    }
    .spinner{
      width:32px;
      height:32px;
      border:3px solid rgba(255,255,255,0.1);
      border-top:3px solid var(--accent);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    .loading-indicator p{
      color:var(--muted);
      margin:0;
      font-size:14px;
    }
    .issue-frame{
      width:100%;
      height:100%;
      border:none;
      background:#fff;
      border-radius:0 0 12px 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .guide-steps{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .step{
      display:flex;
      gap:16px;
      align-items:flex-start;
    }
    .step-number{
      width:28px;
      height:28px;
      border-radius:50%;
      background:linear-gradient(135deg,var(--accent),#7dd3fc);
      color:#04263b;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:14px;
      flex:0 0 28px;
    }
    .step-content{
      flex:1;
    }
    .step-content strong{
      display:block;
      margin-bottom:4px;
      color:#e6eef8;
    }
    .open-renderer-btn{
      padding:6px 12px;
      border-radius:6px;
      text-decoration:none;
      font-size:12px;
      font-weight:600;
      transition:all 0.2s ease;
      display:none;
      background:rgba(255,255,255,0.05);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.1);
    }
    .open-renderer-btn.show{ display:inline-flex; }
    .step-content p{
      margin:0;
      font-size:14px;
    }
    .step-content code{
      background:rgba(255,255,255,0.1);
      padding:2px 6px;
      border-radius:4px;
      font-family:monospace;
      font-size:13px;
    }

    footer{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin-top:40px;
    }

    @media (max-width:880px){
      header{flex-direction:column;align-items:flex-start}
      .nav{
        width:100%;
        justify-content:center;
        margin-top:12px;
      }
      main{padding:20px}
      .weekly-header h2{font-size:24px}
      .control-panel{
        grid-template-columns:1fr;
        gap:16px;
      }
      .current-issue-header{
        flex-direction:column;
        align-items:flex-start;
        gap:12px;
      }
      .issue-actions{
        width:100%;
        justify-content:flex-start;
      }
      .issue-frame-container{
      .open-renderer-btn{
        padding:6px 12px;
        border-radius:6px;
        text-decoration:none;
        font-size:12px;
        font-weight:600;
        transition:all 0.2s ease;
        display:none;
        background:rgba(255,255,255,0.05);
        color:var(--muted);
        border:1px solid rgba(255,255,255,0.1);
      }
      .open-renderer-btn.show{ display:inline-flex; }
        height:60vh;
        min-height:400px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner">
      <div class="brand">
        <div class="brand-text">润学周报 - 永不失联</div>
        <nav class="nav">
          <a href="/" class="nav-item">主页</a>
          <a href="/weekly_update/" class="nav-item active">润学周报</a>
          <a href="/about/" class="nav-item">关于</a>
        </nav>
      </div>
    </div>

    <main>
      <div class="card hero">
        <h2>润学周报</h2>
        <p>每周为你精选润学相关的最新资讯、政策变化、经验分享和实用工具</p>
      </div>
      <div class="card">
        <!-- 期刊选择器 -->
        <div class="issue-selector">
          <h3>选择期刊</h3>
          <div class="selector-container">
            <select id="issueSelect" class="issue-select">
              <option value="">正在加载期刊列表...</option>
            </select>
            <button id="refreshBtn" class="refresh-btn" title="刷新期刊列表">🔄</button>
          </div>
        </div>

        <!-- 当前显示的期刊 -->
        <div class="current-issue">
          <div class="current-issue-header">
            <h3 id="currentIssueTitle">📰 润学周报</h3>
            <div class="issue-actions">
              <a id="viewRaw" href="#" target="_blank" class="view-btn secondary">📄 查看源码</a>
            </div>
          </div>
          <div class="issue-frame-container">
            <div id="loadingIndicator" class="loading-indicator">
              <div class="spinner"></div>
              <p>正在加载期刊内容...</p>
            </div>
            <!-- 渲染容器：使用前端 fetch + marked 渲染 Markdown 内容 -->
            <div id="issueContent" class="issue-content markdown-body"></div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>&copy; 2024 润学周报 - 永不失联项目</p>
    </footer>
  </div>

  <script src="../assets/js/weekly_update.js" defer></script>
  <style>
    /* Basic GitHub-like markdown styling (light weight) */
    .markdown-body{ background:transparent; color:#e6eef8; }
    .markdown-body h1,.markdown-body h2,.markdown-body h3{ color:#e6eef8 }
    .markdown-body p{ color:var(--muted); line-height:1.8; margin: 0.6em 0 }
    .markdown-body a{ color: var(--accent); text-decoration: underline; }
    .markdown-body a:hover{ color:#7dd3fc; text-decoration: none; }
    .markdown-body pre{ background:#071224; padding:12px; border-radius:8px; overflow:auto }
    .markdown-body code{ background:rgba(255,255,255,0.05); padding:2px 6px; border-radius:6px }
    .markdown-body table{ border-collapse:collapse; width:100%; }
    .markdown-body th, .markdown-body td{ border:1px solid rgba(255,255,255,0.08); padding:8px }
    .markdown-body th{ background: rgba(255,255,255,0.04); color:#e6eef8 }
    .markdown-body tr:nth-child(even){ background: rgba(255,255,255,0.02) }
    .markdown-body blockquote{ border-left:4px solid rgba(255,255,255,0.04); padding-left:12px; color:var(--muted) }
    .markdown-body img{ max-width:100%; height:auto; border-radius:6px }
    .markdown-body ul, .markdown-body ol{ padding-left: 1.4em }
    .markdown-body li+li{ margin-top: 0.3em }
    .markdown-body input[type="checkbox"]{ margin-right:8px; transform: scale(1.05); }
    .markdown-body .task-list-item{ list-style: none; }
  </style>
  
</body>
</html>